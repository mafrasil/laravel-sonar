var Sonar=function(r){"use strict";window.__sonar={queue:[],processing:!1,impressed:new Set,hovered:new Set,observer:null,queueTimeout:null,config:{trackAllHovers:!1}};const u=async()=>{if(window.__sonar.processing||window.__sonar.queue.length===0)return;window.__sonar.processing=!0;const e=[...window.__sonar.queue];window.__sonar.queue=[];try{await fetch("/api/sonar/events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:e})})}catch{window.__sonar.queue=[...e,...window.__sonar.queue]}window.__sonar.processing=!1},i=(e,o,d)=>{const n={name:e,type:o,metadata:d,timestamp:Date.now(),location:window.location.pathname,platform:{user_agent:navigator.userAgent,screen:{width:window.innerWidth,height:window.innerHeight},language:navigator.language,platform:navigator.platform}};window.__sonar.queue.push(n),window.__sonar.queueTimeout&&clearTimeout(window.__sonar.queueTimeout),window.__sonar.queueTimeout=setTimeout(u,1e3)},w=(e,o)=>{const n=e.target.closest("[data-sonar]");if(!n)return;const t=n.getAttribute("data-sonar");if(!t)return;const a=n.getAttribute("data-sonar-metadata"),l=a?JSON.parse(a):void 0;if(!window.__sonar.config.trackAllHovers){if(o==="hover"&&window.__sonar.hovered.has(t))return;o==="hover"&&window.__sonar.hovered.add(t)}i(t,o,l)},c=()=>{document.querySelectorAll("[data-sonar]").forEach(e=>{const o=e.getBoundingClientRect();if(!(o.top<window.innerHeight&&o.bottom>=0))return;const n=e.getAttribute("data-sonar");if(!n||window.__sonar.impressed.has(n))return;const t=e.getAttribute("data-sonar-metadata"),a=t?JSON.parse(t):void 0;window.__sonar.impressed.add(n),i(n,"impression",a)})},s=()=>{window.__sonar.observer&&window.__sonar.observer.disconnect(),window.__sonar.observer=new MutationObserver(c),window.__sonar.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0}),document.addEventListener("click",e=>w(e,"click")),document.addEventListener("mouseover",e=>w(e,"hover")),document.addEventListener("inertia:start",()=>{window.__sonar.impressed.clear(),window.__sonar.hovered.clear()}),c(),window.addEventListener("beforeunload",()=>{window.__sonar.queue.length>0&&u()})};typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",s):s());const _=e=>{window.__sonar.config={...window.__sonar.config,...e}};return r.configureSonar=_,r.initSonar=s,r.queueEvent=i,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r}({});
