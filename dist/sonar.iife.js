var Sonar=function(r){"use strict";window.__sonar={queue:[],processing:!1,impressed:new Set,hovered:new Set,observer:null,queueTimeout:null};const u=async()=>{if(window.__sonar.processing||window.__sonar.queue.length===0)return;window.__sonar.processing=!0;const e=[...window.__sonar.queue];window.__sonar.queue=[];try{await fetch("/api/sonar/events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:e})})}catch{window.__sonar.queue=[...e,...window.__sonar.queue]}window.__sonar.processing=!1},i=(e,t,d)=>{const n={name:e,type:t,metadata:d,timestamp:Date.now(),page:window.location.pathname,userAgent:navigator.userAgent,screenSize:{width:window.innerWidth,height:window.innerHeight}};window.__sonar.queue.push(n),window.__sonar.queueTimeout&&clearTimeout(window.__sonar.queueTimeout),window.__sonar.queueTimeout=setTimeout(u,1e3)},w=(e,t)=>{const n=e.target.closest("[data-sonar]");if(!n)return;const o=n.getAttribute("data-sonar");if(!o)return;const a=n.getAttribute("data-sonar-metadata"),_=a?JSON.parse(a):void 0;t==="hover"&&window.__sonar.hovered.has(o)||(t==="hover"&&window.__sonar.hovered.add(o),i(o,t,_))},c=()=>{document.querySelectorAll("[data-sonar]").forEach(e=>{const t=e.getBoundingClientRect();if(!(t.top<window.innerHeight&&t.bottom>=0))return;const n=e.getAttribute("data-sonar");if(!n||window.__sonar.impressed.has(n))return;const o=e.getAttribute("data-sonar-metadata"),a=o?JSON.parse(o):void 0;window.__sonar.impressed.add(n),i(n,"impression",a)})},s=()=>{window.__sonar.observer&&window.__sonar.observer.disconnect(),window.__sonar.observer=new MutationObserver(c),window.__sonar.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0}),document.addEventListener("click",e=>w(e,"click")),document.addEventListener("mouseover",e=>w(e,"hover")),document.addEventListener("inertia:start",()=>{window.__sonar.impressed.clear(),window.__sonar.hovered.clear()}),c(),window.addEventListener("beforeunload",()=>{window.__sonar.queue.length>0&&u()})};return typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",s):s()),r.initSonar=s,r.queueEvent=i,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r}({});
